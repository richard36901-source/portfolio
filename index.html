<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AutoScale | תיק עבודות</title>
  <meta name="description" content="AutoScale תיק עבודות: CRM, WhatsApp בוטים ואוטומציות לעסקים." />

  <style>
    :root{
      --bg:#0b0f17;
      --panel:rgba(18,26,42,.78);
      --card:rgba(18,26,42,.86);
      --muted:#9aaad0;
      --text:#eaf0ff;
      --border:rgba(255,255,255,.10);
      --shadow:0 10px 30px rgba(0,0,0,.38);
      --cta:#6aa6ff;
      --cta2:#7cffa6;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:
        radial-gradient(1100px 760px at 12% 0%, rgba(106,166,255,.18), transparent 60%),
        radial-gradient(900px 640px at 88% 10%, rgba(124,255,166,.12), transparent 60%),
        var(--bg);
    }
    a{ color:inherit; text-decoration:none; }

    .wrap{ max-width:1100px; margin:0 auto; padding:26px 16px 70px; }

    .top{
      border:1px solid var(--border);
      background:var(--panel);
      border-radius:18px;
      box-shadow:var(--shadow);
      padding:18px;
    }

    .titleRow{
      display:flex;
      justify-content:center;
      align-items:center;
      gap:12px;
      text-align:center;
    }
    .logo{
      width:44px; height:44px; border-radius:14px;
      border:1px solid rgba(106,166,255,.35);
      background: linear-gradient(135deg, rgba(106,166,255,.25), rgba(124,255,166,.12));
      display:flex; align-items:center; justify-content:center;
      font-weight:900;
      flex:0 0 auto;
    }
    h1{
      margin:0;
      font-size:22px;
      letter-spacing:.2px;
    }
    .sub{
      margin-top:10px;
      text-align:center;
      color:var(--muted);
      line-height:1.65;
    }

    .ctaTop{
      display:flex;
      justify-content:center;
      margin-top:14px;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding:11px 14px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(15,22,38,.85);
      font-size:14px;
      cursor:pointer;
      white-space:nowrap;
      transition: transform .12s ease, border-color .12s ease;
    }
    .btn:active{ transform: scale(.99); }

    .btnCta{
      border-color: rgba(106,166,255,.65);
      background: rgba(106,166,255,.18);
    }
    .btnCta:hover{
      border-color: rgba(106,166,255,.95);
    }

    .btnGreen{
      border-color: rgba(124,255,166,.60);
      background: rgba(124,255,166,.12);
    }
    .btnGreen:hover{
      border-color: rgba(124,255,166,.95);
    }

    .controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:14px;
      justify-content:center;
    }
    .search, select{
      border:1px solid var(--border);
      background:rgba(15,22,38,.88);
      color:var(--text);
      border-radius:14px;
      padding:11px 12px;
      outline:none;
      font-size:14px;
    }
    .search{ flex: 1 1 340px; max-width: 560px; }
    select{ flex: 0 0 220px; cursor:pointer; }

    .section{
      margin-top:16px;
      border:1px solid var(--border);
      background:rgba(18,26,42,.58);
      border-radius:18px;
      box-shadow:var(--shadow);
      padding:14px;
    }
    .sectionTitle{
      margin:0 0 10px;
      font-size:14px;
      color:rgba(234,240,255,.92);
    }

    .cols{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:12px;
    }
    .col{
      grid-column: span 6;
      border:1px solid var(--border);
      background:rgba(15,22,38,.66);
      border-radius:16px;
      padding:12px;
    }
    @media (max-width: 900px){ .col{ grid-column: span 12; } }

    .col h3{
      margin:0 0 6px;
      font-size:14px;
    }
    .bullets{
      margin:8px 0 0;
      padding:0 18px 0 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.75;
    }
    .bullets li{ margin:6px 0; }

    .showcases{
      margin-top:16px;
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:14px;
    }
    .case{
      grid-column: span 6;
      border:1px solid var(--border);
      background:var(--card);
      border-radius:18px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    @media (max-width: 900px){ .case{ grid-column: span 12; } }

    .caseHead{
      padding:14px 14px 10px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:flex-start;
    }
    .caseTitle{
      margin:0;
      font-size:16px;
      font-weight:800;
    }
    .badge{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(106,166,255,.45);
      background:rgba(106,166,255,.12);
      white-space:nowrap;
      color:rgba(234,240,255,.92);
    }
    .caseDesc{
      padding:0 14px 12px;
      color:var(--muted);
      font-size:13px;
      line-height:1.6;
    }

    .thumbGrid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:10px;
      padding:12px 14px 0;
    }
    .thumb{
      grid-column: span 6;
      border:1px solid var(--border);
      border-radius:14px;
      overflow:hidden;
      background:rgba(10,14,22,.35);
      cursor:pointer;
      transition: transform .12s ease, border-color .12s ease;
    }
    .thumb:hover{ transform: translateY(-1px); border-color: rgba(106,166,255,.45); }
    @media (max-width: 900px){ .thumb{ grid-column: span 12; } }

    .thumb img{
      width:100%;
      height:auto;
      display:block;
    }
    .cap{
      padding:10px;
      color:var(--muted);
      font-size:12px;
      line-height:1.6;
      border-top:1px solid var(--border);
      background:rgba(15,22,38,.55);
    }

    .caseCta{
      display:flex;
      justify-content:center;
      padding:14px;
    }
    .caseCta .btn{
      min-width: 260px;
      font-weight:800;
      border-color: rgba(106,166,255,.75);
      background: rgba(106,166,255,.20);
    }

    .divider{
      height:1px;
      background: rgba(255,255,255,.08);
      margin:14px 0;
    }

    .timelineWrap{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    .timeline{
      position:relative;
      padding-right:18px;
    }
    .line{
      position:absolute;
      right:7px;
      top:10px;
      bottom:10px;
      width:2px;
      background: rgba(255,255,255,.10);
      border-radius:99px;
      overflow:hidden;
    }
    .lineFill{
      width:100%;
      height:0%;
      background: rgba(106,166,255,.75);
      border-radius:99px;
      transition: height .25s ease;
    }

    .step{
      position:relative;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(15,22,38,.62);
      border-radius:16px;
      padding:12px;
      margin:10px 0;
      box-shadow: 0 0 0 rgba(0,0,0,0);
      transform: translateY(0);
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
    }
    .dot{
      position:absolute;
      right:0;
      top:18px;
      width:14px;
      height:14px;
      border-radius:50%;
      border:2px solid rgba(255,255,255,.22);
      background: rgba(11,15,23,.9);
      transform: translateX(50%);
      transition: border-color .18s ease, background .18s ease;
    }
    .step.active{
      border-color: rgba(106,166,255,.65);
      box-shadow: 0 12px 32px rgba(0,0,0,.35);
      transform: translateY(-2px);
    }
    .step.active .dot{
      border-color: rgba(106,166,255,.95);
      background: rgba(106,166,255,.45);
    }
    .stepTitle{
      margin:0 0 6px;
      font-size:14px;
      font-weight:800;
    }
    .stepText{
      margin:0;
      color:var(--muted);
      font-size:13px;
      line-height:1.6;
    }
    .stepActions{
      margin-top:10px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }

    .footerCta{
      margin-top:16px;
      display:flex;
      justify-content:center;
    }

    /* Lightbox */
    .lightbox{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.70);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:100;
      padding:16px;
    }
    .lightbox.open{ display:flex; }

    .lbBox{
      width: min(1100px, 100%);
      border:1px solid rgba(255,255,255,.12);
      background: rgba(11,15,23,.92);
      border-radius:18px;
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .lbTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,.10);
      background: rgba(18,26,42,.55);
    }
    .lbTitle{
      margin:0;
      font-size:13px;
      color: rgba(234,240,255,.92);
      line-height:1.4;
    }
    .lbClose{
      padding:9px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(15,22,38,.85);
      color: var(--text);
      cursor:pointer;
      font-size:13px;
    }

    .lbImgWrap{
      position:relative;
      background: rgba(0,0,0,.25);
    }
    .lbImg{
      width:100%;
      height:auto;
      display:block;
      max-height: 72vh;
      object-fit: contain;
    }
    .lbCap{
      padding:10px 12px;
      color: var(--muted);
      font-size:12px;
      line-height:1.6;
      border-top:1px solid rgba(255,255,255,.10);
      background: rgba(15,22,38,.55);
    }

    .lbNav{
      position:absolute;
      top:50%;
      transform: translateY(-50%);
      width:44px;
      height:44px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(15,22,38,.78);
      color: var(--text);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:18px;
      user-select:none;
    }
    .lbPrev{ left:10px; }
    .lbNext{ right:10px; }

    .note{
      margin-top:10px;
      color:var(--muted);
      font-size:12px;
      line-height:1.6;
      text-align:center;
    }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="top">
      <div class="titleRow">
        <div class="logo">AS</div>
        <h1>AutoScale תיק עבודות</h1>
      </div>

      <div class="sub">
        CRM ו WhatsApp לעסקים, עם אוטומציות שמביאות סדר ותוצאה.
      </div>

      <div class="ctaTop">
        <a id="waTop" class="btn btnCta" href="#" target="_blank" rel="noopener">דברי/י איתנו בווצאפ</a>
      </div>

      <div class="controls">
        <input id="search" class="search" type="search" placeholder="חיפוש: monday, wati, lead, חוזה, calendly..." />
        <select id="filter">
          <option value="all">כל הקטגוריות</option>
          <option value="CRM">CRM</option>
          <option value="Chatbot">WhatsApp</option>
          <option value="Contracts">חוזים וחתימה</option>
          <option value="Integrations">אינטגרציות</option>
          <option value="Other">אחר</option>
        </select>
      </div>

      <div class="note">
        מוצגים רק חומרים ללא מידע רגיש. פרטים מזהים מטושטשים.
      </div>
    </div>

    <section class="section">
      <h2 class="sectionTitle">למי זה מתאים</h2>
      <div class="cols">
        <div class="col">
          <h3>עסקים שמקבלים לידים ורוצים סדר</h3>
          <ul class="bullets">
            <li>קליטת לידים אוטומטית מכל מקור בלי פספוסים</li>
            <li>סטטוסים, משימות, תיעוד והודעות במקום אחד</li>
            <li>פולואפ חכם שמעלה סיכוי לסגירה</li>
          </ul>
        </div>
        <div class="col">
          <h3>תחומים נפוצים</h3>
          <ul class="bullets">
            <li>נדל״ן, עורכי דין, פיננסים, שירותים מקצועיים</li>
            <li>קליניקות, מכוני טיפולים, נותני שירות, סוכנויות</li>
            <li>עסקים עם צוות מכירות או שירות לקוחות ב WhatsApp</li>
          </ul>
        </div>
      </div>
    </section>

    <div id="showcases" class="showcases"></div>

    <section class="section">
      <h2 class="sectionTitle">אפשרויות עבודה</h2>
      <div class="cols">
        <div class="col">
          <h3>פרויקט הקמה</h3>
          <ul class="bullets">
            <li>הקמה מלאה מקצה לקצה כולל אפיון ותוצר מוכן</li>
            <li>שיפור ושדרוג לפי צרכים והטמעה נכונה</li>
            <li>הדרכה לצוות כדי שהמערכת תעבוד ביום יום</li>
          </ul>
        </div>
        <div class="col">
          <h3>שדרוג, תחזוקה והדרכה</h3>
          <ul class="bullets">
            <li>בנק שעות לשדרוג מערכת קיימת, תיקונים ושיפורים</li>
            <li>תמיכה חודשית למערכות פעילות כולל פתרון תקלות</li>
            <li>הדרכה וליווי לצוות ב CRM, WhatsApp ותהליכים</li>
            <li>ביקורת מערכת קיימת והמלצות לשדרוג מהיר</li>
          </ul>
        </div>
      </div>
    </section>

    <section class="section">
      <h2 class="sectionTitle">איך מתחילים</h2>

      <div class="timelineWrap">
        <div class="timeline">
          <div class="line"><div id="lineFill" class="lineFill"></div></div>

          <div class="step" data-step="1">
            <div class="dot"></div>
            <h3 class="stepTitle">קביעת שיחת אפיון</h3>
            <p class="stepText">קובעים שיחה קצרה כדי להבין מטרה, מצב קיים ומה התוצאה שאתה רוצה.</p>
            <div class="stepActions">
              <a class="btn btnGreen" href="https://calendly.com/richardtomskiy/30min" target="_blank" rel="noopener">לקביעת שיחת איפיון</a>
            </div>
          </div>

          <div class="step" data-step="2">
            <div class="dot"></div>
            <h3 class="stepTitle">שיחת אפיון</h3>
            <p class="stepText">ממפים תהליך, מערכות קיימות, נקודות כשל, ומה חייב להיות אוטומטי.</p>
          </div>

          <div class="step" data-step="3">
            <div class="dot"></div>
            <h3 class="stepTitle">הצעת מחיר</h3>
            <p class="stepText">הצעה ברורה שמגדירה מה נכנס, מה לא נכנס, ולוחות זמנים.</p>
          </div>

          <div class="step" data-step="4">
            <div class="dot"></div>
            <h3 class="stepTitle">תוצר ראשוני</h3>
            <p class="stepText">מוציאים תוצר ראשוני מהר כדי לוודא כיוון ותוצאה.</p>
          </div>

          <div class="step" data-step="5">
            <div class="dot"></div>
            <h3 class="stepTitle">שיפור ושדרוג בהתאמה ללקוח</h3>
            <p class="stepText">שיפורים לפי שימוש אמיתי, טיפול בקצוות, יציבות ולוגים.</p>
          </div>

          <div class="step" data-step="6">
            <div class="dot"></div>
            <h3 class="stepTitle">מסירת תוצר מוכן</h3>
            <p class="stepText">מסירה מסודרת של מערכת מוכנה לעבודה, כולל בדיקות.</p>
          </div>

          <div class="step" data-step="7">
            <div class="dot"></div>
            <h3 class="stepTitle">הדרכה לעבודה נכונה</h3>
            <p class="stepText">הדרכה לצוות כדי להטמיע תהליך נכון ולהוציא תוצאה.</p>
          </div>

          <div class="step" data-step="8">
            <div class="dot"></div>
            <h3 class="stepTitle">תמיכה לכל אורך הדרך ואחריה</h3>
            <p class="stepText">אפשר בנק שעות או תמיכה חודשית לפי צורך.</p>
          </div>

        </div>
      </div>

      <div class="footerCta">
        <a id="waBottom" class="btn btnCta" href="#" target="_blank" rel="noopener">דברי/י איתנו בווצאפ</a>
      </div>
    </section>

  </div>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox" aria-modal="true" role="dialog">
    <div class="lbBox">
      <div class="lbTop">
        <h4 id="lbTitle" class="lbTitle">תמונה</h4>
        <button id="lbClose" class="lbClose">סגירה</button>
      </div>

      <div class="lbImgWrap">
        <button id="lbPrev" class="lbNav lbPrev" aria-label="קודם">‹</button>
        <button id="lbNext" class="lbNav lbNext" aria-label="הבא">›</button>
        <img id="lbImg" class="lbImg" alt="צילום מסך" />
      </div>

      <div id="lbCap" class="lbCap"></div>
    </div>
  </div>

  <script>
    const WHATSAPP_NUMBER = "972545764327";

    const WA_TOP_TEXT = "היי AutoScale, ראיתי את תיק העבודות. אשמח לשיחה קצרה על CRM ו WhatsApp עבור העסק שלי. איזה פרטים צריך ממני כדי להתחיל?";
    function waLink(text){
      return "https://wa.me/" + WHATSAPP_NUMBER + "?text=" + encodeURIComponent(text);
    }

    const waTop = document.getElementById("waTop");
    const waBottom = document.getElementById("waBottom");
    if(waTop) waTop.href = waLink(WA_TOP_TEXT);
    if(waBottom) waBottom.href = waLink(WA_TOP_TEXT);

    function badgeName(cat){
      if(cat === "Chatbot") return "WhatsApp";
      if(cat === "Contracts") return "חוזים וחתימה";
      if(cat === "Integrations") return "אינטגרציות";
      return cat;
    }

    const projects = [
      {
        id: "whatsapp-bot",
        title: "WhatsApp בוט לסינון לידים והעברה לנציג",
        category: "Chatbot",
        summary: "בוט WhatsApp שמבצע שאלות סינון, שומר מידע, ומעביר לנציג כשצריך.",
        ctaText: "ראיתי את הווצאפ בוט בתיק עבודות אני גם רוצה",
        images: [
          { src: "assets/screenshots/wa-chat-1.png", caption: "שיחה לדוגמה עם שאלות סינון ותיעוד." },
          { src: "assets/screenshots/wa-flow-1.png", caption: "לוגיקה וניהול מסלולים לפי כוונה." }
        ]
      },
      {
        id: "crm-system",
        title: "מערכת CRM עם קליטת לידים ופולואפ",
        category: "CRM",
        summary: "קליטת לידים אוטומטית, תיוג לפי מקור, שיוך לנציג, משימות ופולואפ.",
        ctaText: "ראיתי את מערכת ה CRM בתיק עבודות אני גם רוצה",
        images: [
          { src: "assets/screenshots/crm-board-1.png", caption: "לוח CRM עם סטטוסים, בעלות ומשימות." },
          { src: "assets/screenshots/crm-flow-1.png", caption: "קליטת ליד עם בדיקות וניקוי נתונים." }
        ]
      },
      {
        id: "contracts",
        title: "חוזה אוטומטי ושליחה לחתימה",
        category: "Contracts",
        summary: "יצירת חוזה מתוך נתוני CRM, שליחה לחתימה, סטטוסים ותזכורות.",
        ctaText: "ראיתי את תהליך החוזים והחתימה בתיק עבודות אני גם רוצה",
        images: [
          { src: "assets/screenshots/contract-template-1.png", caption: "תבנית חוזה עם משתנים וסעיפים דינמיים." },
          { src: "assets/screenshots/contract-status-1.png", caption: "סטטוס חתימה ועדכונים אוטומטיים." }
        ]
      },
      {
        id: "calendar",
        title: "תיאום פגישות אוטומטי ועדכון CRM",
        category: "Integrations",
        summary: "קביעת פגישה, תזכורות אוטומטיות ותיעוד במערכת.",
        ctaText: "ראיתי את תיאום הפגישות בתיק עבודות אני גם רוצה",
        images: [
          { src: "assets/screenshots/calendly-1.png", caption: "דף קביעת פגישה עם זמינות." },
          { src: "assets/screenshots/meeting-flow-1.png", caption: "יצירת פגישה, הודעות ותיעוד." }
        ]
      }
    ];

    const showcases = document.getElementById("showcases");
    const search = document.getElementById("search");
    const filter = document.getElementById("filter");

    function esc(s){
      return String(s).replace(/[&<>"']/g, ch => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[ch]));
    }

    function buildCard(p, idx){
      const thumbs = p.images.map((img, j) => {
        return ""
          + "<div class=\"thumb\" data-open=\"" + idx + "\" data-img=\"" + j + "\">"
          +   "<img src=\"" + esc(img.src) + "\" alt=\"צילום מסך\" loading=\"lazy\" />"
          +   "<div class=\"cap\">" + esc(img.caption || "") + "</div>"
          + "</div>";
      }).join("");

      const waMsg = p.ctaText || WA_TOP_TEXT;

      return ""
        + "<article class=\"case\" data-cat=\"" + esc(p.category) + "\">"
        +   "<div class=\"caseHead\">"
        +     "<div>"
        +       "<div class=\"caseTitle\">" + esc(p.title) + "</div>"
        +     "</div>"
        +     "<span class=\"badge\">" + esc(badgeName(p.category)) + "</span>"
        +   "</div>"
        +   "<div class=\"caseDesc\">" + esc(p.summary) + "</div>"
        +   "<div class=\"thumbGrid\">" + thumbs + "</div>"
        +   "<div class=\"caseCta\">"
        +     "<a class=\"btn\" href=\"" + waLink(waMsg) + "\" target=\"_blank\" rel=\"noopener\">דברי/י איתנו בווצאפ</a>"
        +   "</div>"
        + "</article>";
    }

    function render(){
      if(!showcases) return;

      const q = (search && search.value ? search.value.trim().toLowerCase() : "");
      const cat = (filter && filter.value ? filter.value : "all");

      const filtered = projects.filter(p => {
        const hay = (p.title + " " + p.summary).toLowerCase();
        const okSearch = !q || hay.includes(q);
        const okCat = (cat === "all") || (p.category === cat);
        return okSearch && okCat;
      });

      showcases.innerHTML = filtered.map((p) => buildCard(p, projects.indexOf(p))).join("");

      showcases.querySelectorAll("[data-open]").forEach(el => {
        el.addEventListener("click", (e) => {
          const projIdx = Number(el.getAttribute("data-open"));
          const imgIdx = Number(el.getAttribute("data-img"));
          openLightbox(projIdx, imgIdx);
        });
      });
    }

    if(search) search.addEventListener("input", render);
    if(filter) filter.addEventListener("change", render);

    /* Lightbox logic */
    const lightbox = document.getElementById("lightbox");
    const lbImg = document.getElementById("lbImg");
    const lbCap = document.getElementById("lbCap");
    const lbTitle = document.getElementById("lbTitle");
    const lbClose = document.getElementById("lbClose");
    const lbPrev = document.getElementById("lbPrev");
    const lbNext = document.getElementById("lbNext");

    let currentProj = 0;
    let currentImg = 0;

    function showLightbox(){
      const p = projects[currentProj];
      const img = p.images[currentImg];
      if(lbTitle) lbTitle.textContent = p.title;
      if(lbImg) lbImg.src = img.src;
      if(lbCap) lbCap.textContent = img.caption || "";
      if(lightbox) lightbox.classList.add("open");
      document.body.style.overflow = "hidden";
    }

    function openLightbox(projIdx, imgIdx){
      currentProj = projIdx;
      currentImg = imgIdx;
      showLightbox();
    }

    function closeLightbox(){
      if(lightbox) lightbox.classList.remove("open");
      document.body.style.overflow = "";
    }

    function prevImg(){
      const p = projects[currentProj];
      currentImg = (currentImg - 1 + p.images.length) % p.images.length;
      showLightbox();
    }

    function nextImg(){
      const p = projects[currentProj];
      currentImg = (currentImg + 1) % p.images.length;
      showLightbox();
    }

    if(lbClose) lbClose.addEventListener("click", closeLightbox);
    if(lbPrev) lbPrev.addEventListener("click", prevImg);
    if(lbNext) lbNext.addEventListener("click", nextImg);

    if(lightbox){
      lightbox.addEventListener("click", (e) => {
        if(e.target === lightbox) closeLightbox();
      });
    }

    window.addEventListener("keydown", (e) => {
      if(!lightbox || !lightbox.classList.contains("open")) return;
      if(e.key === "Escape") closeLightbox();
      if(e.key === "ArrowLeft") nextImg();
      if(e.key === "ArrowRight") prevImg();
    });

    /* Timeline highlight on scroll */
    const steps = Array.from(document.querySelectorAll(".step"));
    const lineFill = document.getElementById("lineFill");

    function setActiveStep(index){
      steps.forEach((s, i) => {
        if(i === index) s.classList.add("active");
        else s.classList.remove("active");
      });

      if(lineFill){
        const pct = steps.length <= 1 ? 100 : (index / (steps.length - 1)) * 100;
        lineFill.style.height = pct + "%";
      }
    }

    if(steps.length){
      let current = 0;
      const io = new IntersectionObserver((entries) => {
        const visible = entries
          .filter(en => en.isIntersecting)
          .sort((a,b) => b.intersectionRatio - a.intersectionRatio)[0];

        if(visible){
          const idx = steps.indexOf(visible.target);
          if(idx >= 0){
            current = idx;
            setActiveStep(current);
          }
        }
      }, { threshold: [0.25, 0.45, 0.65] });

      steps.forEach(s => io.observe(s));
      setActiveStep(0);
    }

    render();
  </script>
</body>
</html>
